# Implementation: T-8 â€” Create spec template YAML files in .claude/spec-templates/

**Date:** 2026-02-18

## Changes Made

- `.claude/spec-templates/rest-crud-endpoint.yaml`: Created reusable spec template for REST CRUD (Create, Read, Update, Delete) endpoints. Includes 7 assertions covering POST 201, GET 200 list, GET 200/404 by ID, PUT 200, DELETE 204, Content-Type header, and input validation. Constraints enforce Express.js Router, app/server split, and Jest+supertest tests. File scope patterns target `src/routes/{entity}.js`, `src/app.js`, and `tests/{entity}.test.js`.

- `.claude/spec-templates/auth-flow.yaml`: Created reusable spec template for authentication flows. Includes 7 assertions covering login returns token (200), invalid credentials return 401, protected route requires Authorization header, expired/malformed token returns 401, logout invalidates token, bcrypt password storage, and middleware pattern for auth enforcement. Constraints enforce JWT or session-based auth, bcrypt minimum cost factor 10, and dedicated middleware file. File scope patterns target `src/routes/auth.js`, `src/middleware/auth.js`, and `tests/auth.test.js`.

- `.claude/spec-templates/data-pipeline.yaml`: Created reusable spec template for data processing pipelines. Includes 5 assertions covering input validation with error output, transformation produces expected output schema, error isolation per record, idempotent processing, and output written to correct destination. Constraints enforce streaming/chunked approach, per-record error isolation, and test coverage. File scope patterns target `src/pipelines/{name}.js`, `src/transformers/{name}.js`, and `tests/pipelines/{name}.test.js`.

- `implementation-artifacts/2026-02-18-impl-T-8.md`: This file.

## Decisions Made During Implementation

- **7 assertions for REST CRUD vs fewer:** The architecture specifies a max of 7 assertions per task. REST CRUD has exactly 5 HTTP operations (POST, GET list, GET by ID, PUT, DELETE) plus 2 cross-cutting concerns (Content-Type and input validation), making 7 the natural count. All 7 were included as they each test distinct, observable behaviour.

- **auth-flow.yaml marked COMPLEX tier (not MODERATE):** Auth flows involve multiple security-critical concerns: credential validation, token lifecycle, password hashing, middleware isolation, and logout invalidation. COMPLEX tier is appropriate per the tier definitions in spec-protocol.md (multi-layer, security-sensitive).

- **data-pipeline.yaml uses 5 assertions (not 7):** The three core data pipeline concerns (validation, transformation, error handling) plus idempotency and destination routing are fully covered in 5 assertions. Adding 2 more would require less important or overlapping assertions, violating the "every assertion must be relevant" anti-blind-copy rule.

- **Header comment format:** Each template opens with a block comment explaining purpose and a "HOW TO USE" guide. This matches the spec-protocol.md principle that every template must document adaptation rules and warn against blind copying (Section 17 anti-blind-copy rule).

- **{name} placeholder for data-pipeline vs {entity}:** Data pipelines are identified by a processing name (e.g., order-import), not a domain entity (e.g., user). Using {name} is semantically clearer for pipeline files like `src/pipelines/{name}.js`.

## Testing

- Verified all three YAML files are syntactically valid by reading them back.
- Confirmed all placeholder conventions ({entity}, {endpoint}, {file}, {id}, {name}) are documented in file comments and used consistently.
- Confirmed both positive and negative assertions are present in every assertion pair (double-entry principle per architecture.md Pattern 1).
- Confirmed controlled vocabulary (MUST / MUST NOT / SHOULD / MAY) is used throughout assertions and constraints.
- Confirmed no template exceeds 7 assertions.
- Confirmed `file_scope_patterns`, `constraints`, `typical_tier`, `pattern_name`, `description`, and `intent_template` fields are all present (acceptance criteria from Story 5.4 item 2).

## Status

COMPLETED
